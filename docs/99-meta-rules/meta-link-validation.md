# リンクバリデーションルール

ドキュメント内のリンクの品質と整合性を保証するための詳細ルール定義。

## 前提条件とスコープ

CogitoWeave ドキュメント体系では、親が子をまとめる階層構造と、読みやすいリンクテキストの使用を重視する。バリデーションは以下を対象とする：

- 内部リンク(相対パス)の整合性検証
- 外部 URL の許可リスト制御
- リンクテキストの品質評価
- 階層構造の論理的一貫性

## リンクバリデーションの論理

第一に、階層構造の整合性を保証する必要がある。親ディレクトリが子要素をまとめる役割を持つため、子から親への逆流リンクは階層構造を破綻させる。従って `../` パターンでの親ディレクトリへのリンクは原則禁止とする。

第二に、外部 URL の信頼性管理が重要である。許可されていない外部サイトへのリンクは、セキュリティリスクやリンク切れリスクを増大させる。事前に承認された信頼できる URL のみを許可する制限的アプローチを採用する。

第三に、リンクテキストの品質がドキュメントの可読性を決定する。単純なファイルパスやファイル名をそのままリンクテキストにすることは、読み手に内容を推測させる負担を強いる。リンク先の内容を適切に表現する説明的テキストの使用を強制する。

第四に、これらのルールを自動化することで、手動レビューの負担を軽減し、品質の一貫性を保証する。バリデーションエラーは段階的重要度(error/warning)で分類し、適切な修正指針を提供する。

## 結論

以下の 3 つのバリデーションルールを実装する：

1. **親ディレクトリリンク禁止**: `../` で始まる相対パスリンクを error として検出
2. **外部 URL 制限**: 許可リスト外の外部 URL を error として検出
3. **リンクテキスト品質**: ファイルパス的なリンクテキストを warning として検出

これにより、階層構造の論理的一貫性と、読みやすいドキュメントの両立を実現する。

## 実装仕様

### 1. 親ディレクトリリンク禁止

**検出パターン**: `../` で始まる相対パスリンク
**重要度**: error
**対処法**: 親が子への参照を追加し、逆方向リンクを削除

```markdown
# NG 例

[上位概念](../parent-concept.md)

# OK 例

親ディレクトリの README.md に子要素への統合的参照を配置
```

### 2. 外部 URL 許可リスト制御

**許可 URL 一覧** (config.yml):

```yaml
allowed_external_urls:
  - "https://github.com/anthropics/claude-code"
  - "https://docs.python.org/3/"
  - "https://developer.mozilla.org/en-US/"
  - "https://docs.anthropic.com/en/docs/claude-code"
  - "https://www.ikemo3.com"
```

**検出**: 許可リスト外の `https://` URLs
**重要度**: error
**対処法**: 必要に応じて許可リストに追加申請

### 3. リンクテキスト品質バリデーション

**検出パターン**:

- リンクテキスト == ファイルパス (`[file.md](file.md)`)
- リンクテキスト == ファイル名 (`[README.md](path/README.md)`)
- 単純な「README.md」テキスト

**重要度**: warning
**対処法**: 内容を表現する説明的テキストに変更

```markdown
# NG 例

[performance-requirements/README.md](performance-requirements/README.md)
[README.md](ui-design/README.md)

# OK 例

[パフォーマンス要件の統合分析](performance-requirements/README.md)
[UI 設計における設計判断の統合](ui-design/README.md)
```

## バリデーション時のエラー対応

**親ディレクトリリンク検出時**:

1. リンクの必要性を再検討
2. 親側で子要素をまとめる構造への変更
3. 同階層での横断的参照への変更検討

**未許可外部 URL 検出時**:

1. URL の信頼性・必要性評価
2. 必要であれば許可リストへの追加申請
3. 代替リソースへの変更検討

**不適切リンクテキスト検出時**:

1. リンク先内容の把握
2. 内容を適切に表現するテキストへの変更
3. 読み手にとっての分かりやすさを優先
