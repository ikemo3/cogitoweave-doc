---
doc_type: "pattern-research"
status: "draft"
depends:
  contracts:
    - "app-structure-evaluation"
    - "performance-optimization-policy"
    - "technology-selection-criteria"
    - "frontend-rendering-style"
    - "component-granularity-design"
  produces:
    - "metaframework-research"
---

# メタフレームワーク調査

## 前提

<!-- PREMISE_BEGIN: app-structure-evaluation -->

CogitoWeave のアプリケーション構造として以下を採用する。

- 基本構造は MPA または SPA のいずれも可能とする。
  - 画面間状態共有が不要で、各画面の独立性を重視するため、どちらの技術でも要件を満たせる。
- 概念間移動の高速化を最優先とする。
  - 概念ページ読み込み最優先要件を満たすため、技術選択に応じて最適な実装を行う。
- 各画面の独立性を確保する。
  - MPA 選択時は別ページ遷移、SPA 選択時は状態管理の分離により実現する。
- 3 画面という小規模構成を活かしたシンプルな設計とする。
  - 一人開発制約下での理解しやすさと保守性を維持するため。

<!-- PREMISE_END: app-structure-evaluation -->

<!-- PREMISE_BEGIN: performance-optimization-policy -->

CogitoWeave のパフォーマンス最適化方針として以下を採用する。

- 概念ページ読み込み 1.5 秒以内を最優先とする。
  - 最も頻繁な日常操作の快適性確保を最重要視する。
- 初回ロードの遅さは許容し、ページ遷移の高速性を重視する。
  - CSR 特性を活かした継続利用の効率性を優先する。
- 複雑なパフォーマンス最適化は実装しない。
  - 軽量なコンポーネント指向アーキテクチャにより設計段階で最適化を行う。
- ツリーシェイキング対応ライブラリを優先する。
  - 元々軽量で最適化しやすい技術を選択し、開発効率と軽量性を両立する。

<!-- PREMISE_END: performance-optimization-policy -->

<!-- PREMISE_BEGIN: technology-selection-criteria -->

- **最適な技術を選ぶ**: ただし大差ないときは慣れた技術やメジャーなものを選ぶ
- **外部ライブラリは適度に制限**: 依存を少なくして、自分でコントロールできる範囲を広げる
- **監視は最小限**: システムが生きているかどうかを確認する程度の基本的な監視のみ
- **ログは少なめ**: テストでしっかり品質を保つので、ログに頼りすぎない

<!-- PREMISE_END: technology-selection-criteria -->

<!-- PREMISE_BEGIN: frontend-rendering-style -->

CogitoWeave のフロントエンドレンダリングスタイルとして**CSR(Client-Side Rendering)**を採用する。3 画面間の状態共有効率と軽量なコンポーネント指向の特性を活かし、一人での開発における保守性と理解しやすさを確保する。

<!-- PREMISE_END: frontend-rendering-style -->

<!-- PREMISE_BEGIN: component-granularity-design -->

CogitoWeave の UI コンポーネント責務として、階層的な粒度設計による軽量なコンポーネント指向アーキテクチャを採用する。

- **最小粒度**: ボタン・入力フィールド・ラベル等の基本 UI 要素レベル
  - 単一責務の原則により、一つの操作または表示に特化する。
- **統合粒度**: カード・パネル・モーダル等の機能単位レベル
  - 複数の基本要素を組み合わせた意味のある機能を提供する。
- **階層アプローチ**: 統合コンポーネント内で基本コンポーネントを組み合わせる
  - 外部からは統合コンポーネントとして使用し、内部実装では基本コンポーネントで構成する。

<!-- PREMISE_END: component-granularity-design -->

## 調査

### 情報源

State of JS 2024 のメタフレームワーク調査結果を分析する。
<https://2024.stateofjs.com/en-US/libraries/meta-frameworks/>

### 調査対象メタフレームワーク

以下 4 つのメタフレームワークを調査対象とする：

- Next.js (React 用)
- Nuxt (Vue 用)
- SvelteKit (Svelte 用)
- Astro (マルチフレームワーク)

### 除外したメタフレームワーク

- **SolidStart**: SSR ファーストの設計により CSR 前提の要件に適合せず、ハイブリッドアプローチにも不向きである。
- **Deno Fresh**: SSR とエッジ最適化に特化しており、CSR 前提の CogitoWeave には技術的に不適合である。
- **Remix**: SSR を基本とするメタフレームワークであり、CSR 前提の要件に適合しない。Web 標準重視のアプローチは評価できるが、レンダリング戦略が要件と矛盾する。

### 主要メタフレームワークの現状

#### 使用率 (Usage)

- Next.js: 56% → 54% (高使用率、微減)
- Nuxt: 23% → 22% (中使用率、微減)
- Astro: 19% → 23% (中使用率、成長)
- SvelteKit: 17% → 16% (低使用率、微減)

#### 満足度 (Satisfaction)

- Astro: 90% → 94% (最高満足度、大幅上昇)
- SvelteKit: 89% → 90% (高満足度、上昇)
- Nuxt: 76% → 81% (高満足度、上昇)
- Next.js: 76% → 68% (中満足度、大幅下落)

#### 関心度 (Interest)

- Astro: 63% → 67% (最高関心、上昇)
- SvelteKit: 60% → 55% (高関心、やや減少)
- Next.js: 53% → 43% (中関心、大幅減少)
- Nuxt: 42% → 39% (中関心、やや減少)

#### 期待値と現実のギャップ (Appreciation)

- Nuxt: 34% → 42% (期待より大幅に良い)
- SvelteKit: 28% → 35% (期待より良い)
- Astro: 27% → 27% (期待通り)
- Next.js: 23% → 25% (期待より少し良い)

#### 全体的評判 (Positivity)

- Astro: 69% → 73% (高評判、上昇)
- SvelteKit: 66% → 61% (中評判、下降)
- Next.js: 66% → 57% (中評判、大幅下降)
- Nuxt: 51% → 52% (中評判、微上昇)

### React 系ルーティングライブラリの現状

#### NPM 週間ダウンロード数 (2024 年データ)

- **react-router**: 19,824,054 (React エコシステムの基盤的地位)
- **@tanstack/react-router**: 897,435 (1 年前の 5 倍以上の急成長)

**参考値**:

- astro: 753,702 (1 年前の 2.5 倍成長)
- solidjs: 836,180

## 論理

State of JS 2024 のデータから、メタフレームワークの候補を以下の論理で評価する。

MPA または SPA のいずれの構造でも適用可能で、軽量なコンポーネント指向アーキテクチャを阻害しない柔軟なレンダリング戦略とルーティング制御が可能なメタフレームワークが適している。CSR を前提とするため、SSR に過度に依存したフレームワークは適さない。

概念ページの読み込みを 1.5 秒以内にする要件により、軽量で高速なメタフレームワークを優先する。階層的な粒度設計による軽量なコンポーネント指向アーキテクチャと親和性が高く、ツリーシェイキングによる最適化が容易なメタフレームワークが適している。

満足度が高く、期待値と現実のギャップ（Appreciation）がプラスのメタフレームワークは、実際に使用した開発者が期待以上の価値を感じており、一人開発での学習と採用における価値が高い。

一人開発の制約により、学習曲線が緩やかで、コミュニティサポートが充実しているメタフレームワークを選択する必要がある。使用率が極端に低いメタフレームワークは情報不足のリスクがあるため、技術的に大差がない場合は使用率も考慮する。コンポーネントの単一責務原則を支援し、基本 UI 要素から統合機能まで段階的に組み立てられる設計パターンを阻害しないメタフレームワークを選択する。

React Router 7 と TanStack Router は、メタフレームワークとは異なる軽量なルーティングライブラリとして、CSR 前提のハイブリッドアプローチに対して独自の価値を提供する。React Router 7 は React エコシステムにおける圧倒的な基盤的地位（NPM 週間ダウンロード数 19.8M）により、豊富な情報資源と安定した運用実績を保証する。TanStack Router は急成長（1 年で 5 倍以上）により注目を集める新興選択肢として、型安全性と現代的な設計思想を提供する。両者とも CSR 専用設計により、メタフレームワークの複雑性を排除した軽量性とシンプルな学習曲線を実現する。

## 結論

<!-- GLOBAL_CONCLUSION_BEGIN: metaframework-research -->

State of JS 2024 のデータに基づくメタフレームワーク候補の調査結果は以下の通りである。

### メタフレームワーク最優先候補

- **Astro**: 最高満足度 94%、関心度 67%（最高）を記録し、軽量で柔軟なハイブリッドアプローチに対応する。
- **SvelteKit**: 高満足度 90%、期待値ギャップ 35% を示し、Svelte の軽量性を活かしたメタフレームワークである。

### メタフレームワーク次点候補

- **Nuxt**: Vue の生態系において満足度 81%、期待値ギャップ 42%（大幅改善）を達成し、安定したハイブリッド対応を提供する。

### メタフレームワーク除外候補

- **Next.js**: 満足度が 89%（2022 年）→ 76%（2023 年）→ 68%（2024 年）と 3 年連続で急激に下落しており、開発者からの信頼を完全に失っている。App Router の導入による既存 API の大幅破壊、Vercel エコシステムへの強制的な依存、複雑性の爆発的増大により、シンプルさを重視する一人開発には最悪の選択肢となった。フレームワーク自体の肥大化によりパフォーマンス要件も満たせず、技術的に他の選択肢が明らかに優位である。

軽量なコンポーネント指向アーキテクチャ、CSR の前提、一人開発の制約、パフォーマンスの要件を総合すると、Astro と SvelteKit が最有力の候補として浮上し、Nuxt が次点の候補として選定される。

### State of JS 2024 調査対象外の例外候補

- **React Router 7**: Remix との統合により従来のルーティングライブラリがメタフレームワーク機能を獲得した選択肢だが、State of JS 2024 の調査対象に含まれていない理由は不明である。CSR 前提とハイブリッドアプローチには適合する可能性がある。
- **TanStack Router**: 型安全性に重点を置いた純粋なクライアントサイドルーティングライブラリとして、メタフレームワークを使わない軽量な選択肢を提供する。Vite 等との組み合わせで CSR 前提の要件に完全適合する可能性がある。

<!-- GLOBAL_CONCLUSION_END: metaframework-research -->
