---
doc_type: "pattern-logic"
status: "draft"
depends:
  contracts: []
  produces: []
---

# LLM概念候補提示API (Query)

## 前提

CogitoWeaveシステムではLLM概念候補提示が質問内容から関連しそうな概念候補を提示するための参照操作である。LLM概念候補提示は質問探索・概念発見ワークフローで質問入力後に使用される。

LLM概念候補提示は質問文と既存概念の情報を指定して実行され、質問に関連する可能性の高い概念候補を生成して返す責務を持つ。これは外部LLMサービスとの境界越えポイントである。

LLM概念候補提示はQueryパターンに従う外部AI参照操作として、質問関連概念候補を生成する。

## 論理

### API呼び出し方向

```text
UI → LLMService.suggestConcepts(Q)
```

**役割名ベース**: LLMServiceがLLM処理の責務を担当

### 入力項目 (概念レベル)

- **質問文**: ユーザーが入力した質問内容
- **既存概念リスト**: システム内の概念名称・説明の一覧
- **候補数**: 提示する概念候補の最大数
- **関連度閾値**: 提示する概念の最小関連度

### 出力項目 (概念レベル)

- **概念候補リスト**: 質問に関連する概念候補の一覧
- **各候補の関連度**: 質問との関連性を示すスコア
- **関連理由**: なぜその概念が関連するかの説明
- **提示状態**: 候補提示の成功・失敗・部分成功の状態

### エラー項目 (概念レベル)

- **LLMサービスエラー**: 外部LLMサービスの接続・実行失敗
- **質問解析エラー**: 質問内容の解析・理解に失敗した場合
- **概念不足エラー**: 関連する概念候補が見つからない場合
- **レート制限エラー**: LLMサービスの利用制限に達した場合

### CQRS分類

**Query**: データ参照のみの操作 - LLMによる概念候補の生成

## 結論

LLM概念候補提示APIはLLMによる概念候補の生成を担当するQuery操作として、質問文と既存概念リストを入力とし、関連概念候補を返す。

エラーハンドリングではLLMサービスの状態・質問解析・候補妥当性を確認し、適切なエラー情報を提供する。このAPIは質問探索ワークフローの中核機能として、質問から概念への橋渡しを実現する役割を担う。
