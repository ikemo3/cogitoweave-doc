---
doc_type: "pattern-logic"
status: "draft"
depends:
  contracts: []
  produces: []
---

# 空間クラスタ認識API (Query)

## 前提

CogitoWeaveシステムでは空間クラスタ認識が空間配置インターフェースで配置された概念の近接度に基づいてクラスタを認識するための参照操作である。空間クラスタ認識は概念関係性構築ワークフローで空間配置後に使用される。

空間クラスタ認識は概念の座標情報を指定して実行され、近接する概念のグループを自動認識して返す責務を持つ。これは内部アルゴリズムとの境界越えポイントである。

空間クラスタ認識はQueryパターンに従う分析参照操作として、概念の空間的グループ化を実行する。

## 論理

### API呼び出し方向

```text
UI → SpatialService.recognizeClusters(Q)
```

**役割名ベース**: SpatialServiceが空間分析の責務を担当

### 入力項目 (概念レベル)

- **概念座標リスト**: 各概念のID・X座標・Y座標の一覧
- **クラスタ設定**: 近接度閾値・最小クラスタサイズ等のパラメータ
- **認識アルゴリズム**: 使用するクラスタリング手法の指定
- **境界表示オプション**: クラスタ境界の視覚化設定

### 出力項目 (概念レベル)

- **クラスタリスト**: 認識されたクラスタの一覧
- **各クラスタ情報**: クラスタID・所属概念リスト・境界座標
- **孤立概念リスト**: どのクラスタにも属さない概念の一覧
- **認識品質**: クラスタリング結果の妥当性スコア

### エラー項目 (概念レベル)

- **座標不正エラー**: 概念座標の形式不正や範囲外値
- **アルゴリズムエラー**: クラスタリングアルゴリズムの実行失敗
- **設定値エラー**: 不正なクラスタ設定パラメータ
- **システムエラー**: 計算リソース不足等の内部エラー

### CQRS分類

**Query**: データ参照のみの操作 - 空間配置データの分析

## 結論

空間クラスタ認識APIは空間配置データの分析を担当するQuery操作として、概念座標情報を入力とし、認識されたクラスタ情報を返す。

エラーハンドリングでは座標データの妥当性・アルゴリズム実行・設定値を確認し、適切なエラー情報を提供する。このAPIは概念関係性構築ワークフローの中核機能として、直感的な空間配置から論理的なグループ形成への変換を実現する役割を担う。
