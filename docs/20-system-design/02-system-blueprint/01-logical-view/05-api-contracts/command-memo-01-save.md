---
doc_type: "pattern-logic"
status: "draft"
depends:
  contracts: []
  produces: []
---

# 文献メモ保存API (Command)

## 前提

CogitoWeaveシステムでは文献メモが概念に紐付く具体的知識内容を管理するエンティティである。文献メモは1つの概念と1つの文献に関連付けられ、知識蓄積の中核を担う。

文献メモ保存は文献読み込みワークフローの最終段階で実行される。LLMが生成した要約をユーザーが修正した後、概念に関連付けて保存する責務を持つ。

文献メモ保存はCommandパターンに従うデータ変更操作として、文献メモエンティティをシステムに追加する。

## 論理

### API呼び出し方向

```text
UI → MemoService.saveMemo(C)
```

**役割名ベース**: MemoServiceが文献メモ管理の責務を担当

### 入力項目 (概念レベル)

- **概念ID**: 関連付ける概念の識別子
- **文献ID**: 関連付ける文献の識別子
- **メモ内容**: ユーザーが修正した要約内容
- **作成日時**: メモ作成の日時

### 出力項目 (概念レベル)

- **メモID**: 作成された文献メモの一意識別子
- **保存結果**: メモ保存の成功・失敗状態
- **メモ情報**: 作成された文献メモの基本情報

### エラー項目 (概念レベル)

- **関連エンティティエラー**: 指定された概念IDまたは文献IDが存在しない場合
- **内容検証エラー**: メモ内容の形式不正や空内容
- **重複エラー**: 同一概念・文献の組み合わせで既にメモが存在する場合
- **システムエラー**: データ保存失敗等の内部エラー

### CQRS分類

**Command**: データ変更を伴う操作 - 新規文献メモエンティティの作成

## 結論

文献メモ保存APIは新規文献メモエンティティの作成を担当するCommand操作として、概念と文献の関連付けとメモ内容を入力とし、作成されたメモ情報を返す。

エラーハンドリングでは関連エンティティの存在確認と内容検証を行い、適切なエラー情報を提供する。このAPIは文献読み込みワークフローの完了機能として、知識蓄積を実現する役割を担う。
