---
doc_type: "pattern-logic"
status: "draft"
depends:
  contracts:
    - "distributed-communication-design"
    - "service-boundaries-decision"
    - "external-dependency-resilience"
    - "development-constraints"
  produces:
    - "fault-tolerance-strategy"
---

# 耐障害性設計

CogitoWeave システムの 3 サービス完全分離構成における障害対応と復旧戦略を設計する。個人用システムに適したシンプルな耐障害性を確立する。

## 前提

<!-- PREMISE_BEGIN: distributed-communication-design -->

CogitoWeave システムでは以下の分散通信設計を採用する：

**HTTP API による直接通信**を確立する。フロントエンドから 3 サービスへの直接 HTTP/HTTPS 通信により、シンプルで理解しやすい通信アーキテクチャを実現する。JSON データフォーマットと GET/POST による CQS ベースの API 設計で、保守しやすい通信を行う。

**サービス特性ごとのタイムアウト設定**により適切な応答制御を行う。各サービスの処理特性に応じた段階的設定で、適切な応答時間管理を実現する。

**HTTP ステータスコードによるエラーハンドリング**によりシンプルな障害対応を実現する。統一的エラー分類と、サービス特性ごとのリトライ戦略により、外部依存による障害を適切に処理する。

**最小限セキュリティ設計**で個人用途に適した設計を行う。HTTPS 通信と CORS 設定による基本的なセキュリティを確保し、認証認可機能は除外する。作成者本人のみのアクセス制御はデプロイメント環境で対応する。

<!-- PREMISE_END: distributed-communication-design -->

<!-- PREMISE_BEGIN: service-boundaries-decision -->

技術的観点からの最適解は**3 サービス完全分離**となる：

- **コア知識管理サービス**: 安定した CRUD 処理を独立プロセスで実行し、長期安定リリースサイクルで運用
- **LLM 統合サービス**: 外部 API 依存を独立プロセスで分離し、技術進歩に応じた中期リリースサイクルで運用
- **コンテンツ取得サービス**: Web スクレイピングを独立プロセスで分離し、サイト変更に応じた短期リリースサイクルで運用

この構成により実行時の責務分離とリリースサイクルの最適化を両立し、各サービスの独立性を確保できる。

<!-- PREMISE_END: service-boundaries-decision -->

<!-- PREMISE_BEGIN: external-dependency-resilience -->

- **機能分離設計**: LLM 機能障害時もコア機能(保存・閲覧・編集)は継続動作
- **API 障害部分許容**: 外部 API 障害時は該当機能のみ利用不可で運用継続
- **ブラウザ互換性**: 標準 Web 技術使用による互換性問題の最小化

<!-- PREMISE_END: external-dependency-resilience -->

<!-- PREMISE_BEGIN: development-constraints -->

- シンプルで理解しやすい構造、一人で管理可能な複雑度に制限する。

<!-- PREMISE_END: development-constraints -->

## 論理

### 問題設定

3 つの独立サービスと外部依存を持つ個人用システムにおいて、シンプルで保守可能な障害対応戦略を設計する必要がある。個人運用の制約下で実現可能な耐障害性を論理的に導出する。

### 分析

#### 個人用システムの障害特性分析

個人用システム特有の制約と要求を分析し、適切な耐障害性レベルを決定する。

**運用制約**: 一人運用により 24/7 監視・即座復旧は現実的でない。複雑な自動復旧機構は理解・保守困難であり、障害時の対応コストが高い。シンプルな手動復旧を基本とし、明確なエラー情報提供による迅速な原因特定が重要である。

**データ価値**: 個人の知識資産であるため、データ消失は絶対に回避すべき障害である。概念・文献メモ・関係性データは代替不可能な個人資産であり、完全なデータ保護戦略が必要である。

**可用性要求**: 個人用途のため、短時間のサービス停止は許容できる。ビジネス継続性よりもデータ保護とシンプルな復旧を優先する。ベストエフォート型の可用性で十分である。

#### 障害分類と対応戦略

各種障害パターンに対する個人運用可能な対応戦略を設計する。

**データ消失障害**: 最重要な障害パターンとして位置付け、予防と復旧の両面で対策する。定期バックアップによる予防、バックアップ検証による信頼性確保、単純な復元手順による迅速復旧を実現する。

**サービス停止障害**: コア知識管理サービス停止時は全機能停止を許容し、外部依存サービス停止時はコア機能の完全継続を行う。障害原因の明確な表示と手動復旧手順の提供により、一人運用での対応を支援する。

**外部依存障害**: LLM API 制限・サイト構造変更に対して、LLM 機能のみエラー表示でコア機能の完全継続を行う。Web スクレイピングのパース失敗等は完全性を求めず、取得可能な範囲での動作継続を基本とする。

**ネットワーク障害**: 一時的なネットワーク断絶に対して、適切なタイムアウト設定とエラー表示による状況説明を行う。複雑な自動復旧は実装せず、ネットワーク復旧後の手動操作による再開を基本とする。

#### 復旧戦略の設計

個人運用に適した実践的な復旧戦略を設計する。

**手動復旧基本**: 自動復旧機構の複雑さを回避し、明確な手動復旧手順を提供する。障害検知から復旧完了までの手順を文書化し、一人での実行可能性を確保する。

**エラー情報の充実**: 障害発生時に原因特定に必要な情報を分かりやすく表示する。開発者自身が対応するため、技術的詳細を中心とした情報提供を行う。

**データ復旧の簡素化**: バックアップからのデータ復元手順を可能な限り単純化する。コマンドライン操作中心の復旧手順を提供し、スクリプト化による自動化も活用する。

## 結論

<!-- GLOBAL_CONCLUSION_BEGIN: fault-tolerance-strategy -->

CogitoWeave システムでは以下の耐障害性戦略を採用する：

**データ保護最優先戦略**により個人資産の完全保護を実現する。定期バックアップとバックアップ検証により、概念・文献メモ・関係性データの消失を絶対に防止する。シンプルな復元手順により、障害時の迅速なデータ復旧を支援する。

**部分機能継続設計**により外部依存障害への耐性を確保する。コア知識管理機能を中心とした基本機能の継続動作により、外部 API 障害時でも知識体系の閲覧・編集・保存が可能な状態を維持する。

**手動復旧基本方針**により一人運用に適した障害対応を実現する。自動復旧機構の複雑さを回避し、明確な手動復旧手順と充実したエラー情報により、個人での障害対応を支援する。24/7 可用性よりもシンプルな保守性を優先する。

**明確なエラー伝達**により迅速な障害対応を支援する。障害種別・影響範囲・対応手順を分かりやすく表示し、開発者自身の技術的判断を支援する情報提供を行う。適切な対応行動を促すことで、障害からの早期回復を実現する。

<!-- GLOBAL_CONCLUSION_END: fault-tolerance-strategy -->
