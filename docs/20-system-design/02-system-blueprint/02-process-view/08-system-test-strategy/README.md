---
doc_type: "pattern-logic"
status: "draft"
depends:
  contracts:
    - "service-boundaries-decision"
    - "development-constraints"
    - "testing-automation-requirements"
  produces:
    - "system-test-strategy"
---

# システムテスト戦略

## 前提

<!-- PREMISE_BEGIN: service-boundaries-decision -->

技術的観点からの最適解は**3 サービス完全分離**となる：

- **コア知識管理サービス**: 安定した CRUD 処理を独立プロセスで実行し、長期安定リリースサイクルで運用
- **LLM 統合サービス**: 外部 API 依存を独立プロセスで分離し、技術進歩に応じた中期リリースサイクルで運用
- **コンテンツ取得サービス**: Web スクレイピングを独立プロセスで分離し、サイト変更に応じた短期リリースサイクルで運用

この構成により実行時の責務分離とリリースサイクルの最適化を両立し、各サービスの独立性を確保できる。

<!-- PREMISE_END: service-boundaries-decision -->

<!-- PREMISE_BEGIN: development-constraints -->

- シンプルで理解しやすい構造、一人で管理可能な複雑度に制限する。

<!-- PREMISE_END: development-constraints -->

<!-- PREMISE_BEGIN: testing-automation-requirements -->

- **バックエンドは完全に自動テスト**: ほぼ 100%のテストで品質を担保する
- **フロントエンドは状況に応じて使い分け**: ブラウザでの複雑な操作やデザインの確認は手動テスト、ロジック部分は自動テストを行う
- **障害対応をスクリプト化**: 復旧作業を自動化して保守の負担を減らす
- **データ移行を自動化**: データベース構造を変更するときは自動で処理する

<!-- PREMISE_END: testing-automation-requirements -->

## 論理

第一に、分散システム全体レベルでのテスト戦略が必要である。3 サービス分散構成において、各サービスは独立したリリースサイクルを持つため、サービス間の協調動作を継続的に検証する仕組みが不可欠となる。単体テストやコンポーネントテストでは、フロントエンドから 3 つのバックエンドサービスへの実際の通信経路やデータフローを検証できない。

第二に、個人開発の制約下では複雑なテスト環境構築や高度な自動化は現実的でない。一人で管理可能な複雑度という制約により、専用テスト環境の構築・保守や複雑な E2E シナリオの実装は除外すべきである。バックエンド完全自動テストの要件を満たしつつ、保守負荷を最小化するシンプルな検証手法が求められる。

第三に、外部 API 依存を含む分散システムにおいて、実用的な統合テストには工夫が必要である。LLM 統合サービスとコンテンツ取得サービスは外部 API に依存するため、CI 環境での実際の API 呼び出しは不安定要因となる。一方で、複雑なモック環境構築は保守性制約に違反する。この問題を解決するため、外部依存部分はダミーデータ返却により基本疎通のみを検証し、正常系の動作確認に限定することで、シンプルかつ実用的なテスト戦略が可能となる。

## 結論

<!-- GLOBAL_CONCLUSION_BEGIN: system-test-strategy -->

CogitoWeave のシステムテスト戦略として、**CI 統合疎通テスト**を採用する。

- フロントエンドから 3 サービスへの基本疎通確認のみを CI 環境で実行する
- 外部 API 依存部分はバックエンドサービス内でモック実装によりダミーデータを返却して検証する
- バックエンドサービスは実際に起動してフロントエンドからの HTTP 通信を受け付けるため、フロントエンド側でのモック機能は不要となる
- 正常系とセキュリティテストをカバーし、エラーハンドリングや複雑な E2E シナリオは単体テストレベルで対応済みとして除外する

CI 失敗時は PR マージ停止、修正または revert による迅速復旧を基本とし、専用テスト環境は構築せず、一人で管理可能なシンプルな品質保証体制を実現する。

<!-- GLOBAL_CONCLUSION_END: system-test-strategy -->
