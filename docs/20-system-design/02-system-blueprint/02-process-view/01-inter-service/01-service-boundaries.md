---
doc_type: "pattern-logic"
status: "draft"
depends:
  contracts:
    - "core-knowledge-boundary"
    - "llm-integration-boundary"
    - "content-acquisition-boundary"
  produces:
    - "service-boundaries-decision"
---

# サービス境界設計

CogitoWeave システムの機能境界を実行時のサービス境界に変換し、プロセス分離とデプロイ単位の組み合わせを決定する。

## 前提

<!-- PREMISE_BEGIN: core-knowledge-boundary -->

- コア知識管理境界は概念管理、文献メモ管理、関係性管理、質問探索を統合して担当する。
  - 各機能の役割を明確に分け、統合的に管理することで保守負荷を軽減するため。

<!-- PREMISE_END: core-knowledge-boundary -->

<!-- PREMISE_BEGIN: llm-integration-boundary -->

- LLM 統合境界は LLM API による要約生成、概念候補提示、協働プロセス制御を担当する。
  - 変わりやすい技術を分離してシンプルな設計を維持するため。

<!-- PREMISE_END: llm-integration-boundary -->

<!-- PREMISE_BEGIN: content-acquisition-boundary -->

- コンテンツ取得境界は外部記事取得、内容解析、品質チェックを担当する。
  - 独立した処理として分離し機能変更時の影響範囲を限定するため。

<!-- PREMISE_END: content-acquisition-boundary -->

## 論理

プロセス分離とデプロイ単位という 2 つの観点から 3 つの機能境界(core-knowledge、llm-integration、content-acquisition)を分析し、技術的観点から最適なサービス境界パターンを決定する。

### プロセス分離分析

実行時の責務分離・パフォーマンス・障害分離の観点から各機能境界を分析する。

**コア知識管理境界**は安定した CRUD 処理で予測可能なパフォーマンスを示す。**LLM 統合境界**は外部 API への依存により応答時間が変動し、障害や制限の影響を受けやすい。**コンテンツ取得境界**は Web スクレイピングにより処理時間が大きく変動し、ネットワーク状況に依存する。

結論：安定性と不安定性が混在し、障害の影響範囲を限定するためプロセス分離が適切である。

### デプロイ単位分析

リリースサイクル・変更頻度・独立配布の観点から各機能境界を分析する。

**コア知識管理境界**は安定した機能で変更頻度が低く、長期間安定したリリースサイクルを持つ。**LLM 統合境界**は技術進歩に応じた変更が発生し、中程度のリリースサイクルを持つ。**コンテンツ取得境界**は対象サイトの構造変更に応じた頻繁な調整が必要で、短期間のリリースサイクルを要求する。

結論：異なるリリースサイクルを持つため、デプロイ単位の分離が適切である。

### サービス境界パターンの決定

プロセス分離とデプロイ単位の分析結果から、各機能境界に最適なサービス境界パターンを論理的に導出する。

**パターン選択の論理**：

- 両観点で分離が必要 → 独立サービス
- 一方のみ分離が必要 → 条件付き分離検討
- 両観点で統合が適切 → モノリス統合

**各境界への適用**：

- **コア知識管理境界**：プロセス安定性(○) + 長期リリース(○) = 独立サービス
- **LLM 統合境界**：プロセス不安定性(分離要) + 中期リリース(分離要) = 独立サービス
- **コンテンツ取得境界**：プロセス不安定性(分離要) + 短期リリース(分離要) = 独立サービス

全境界で両観点から分離の必要性が確認されたため、**3 サービス完全分離**が論理的帰結となる。

## 結論

<!-- GLOBAL_CONCLUSION_BEGIN: service-boundaries-decision -->

技術的観点からの最適解は**3 サービス完全分離**となる：

- **コア知識管理サービス**: 安定した CRUD 処理を独立プロセスで実行し、長期安定リリースサイクルで運用
- **LLM 統合サービス**: 外部 API 依存を独立プロセスで分離し、技術進歩に応じた中期リリースサイクルで運用
- **コンテンツ取得サービス**: Web スクレイピングを独立プロセスで分離し、サイト変更に応じた短期リリースサイクルで運用

この構成により実行時の責務分離とリリースサイクルの最適化を両立し、各サービスの独立性を確保できる。

<!-- GLOBAL_CONCLUSION_END: service-boundaries-decision -->
