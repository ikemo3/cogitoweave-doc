---
doc_type: "pattern-choice"
status: "draft"
depends:
  contracts:
    - "data-protection-requirements"
  produces:
    - "backup-method-tech-selection"
---

# バックアップ方法技術選択

## 概要

CogitoWeave システムのバックアップ方法技術選択を実施する。

### 前提

<!-- PREMISE_BEGIN: data-protection-requirements -->

- **自動バックアップ**: 日次自動バックアップによる合理的なデータ保護
- **迅速復旧**: 障害発生時の当日復旧を目標とした手順整備
- **部分ロス許容**: 完全なゼロリスクは求めず、実用的保護レベルで運用

<!-- PREMISE_END: data-protection-requirements -->

## 選択肢と判断基準

SQLite データベースの安全なバックアップを実現するため、複数の技術的アプローチを比較検討する。

### 判断基準

- **保守性** (優先度高) - 長期運用での管理しやすさ、アップデート頻度、設定の複雑さ
- **信頼性** (優先度高) - データ損失リスク、バックアップ成功率、復旧確実性
- **性能** - バックアップ速度、ストレージ効率、リソース使用量
- **互換性** - S3 互換ストレージとの親和性、Cloudflare エコシステムとの整合性
- **学習コスト** - 習得の容易さ、ドキュメントの充実度

### 選択肢

- **sqlite3 .backup + gzip + rclone**: SQLite 専用バックアップコマンドと圧縮、クラウドアップロードを組み合わせる方式
- **sqlite3 .backup + gzip + AWS CLI**: SQLite 専用バックアップコマンドと AWS CLI を組み合わせる方式
- **Restic**: 専用バックアップソリューションによる高機能バックアップ方式
- **rclone 単体(ファイルコピー)**: クラウドストレージツールによる直接ファイル同期方式

## 各選択肢の詳細分析

各バックアップ方式の特徴を技術的観点から詳細に分析する。

### sqlite3 .backup + gzip + rclone

SQLite 専用バックアップコマンドと圧縮、クラウドアップロードを組み合わせる方式。

- 利点
  - SQLite の標準機能によるホットバックアップで安全性が高い
  - データベース使用中でも整合性を保ったバックアップが可能
  - gzip 圧縮でストレージ効率を向上
  - rclone による Cloudflare R2 へのネイティブアップロード
  - 標準ツールの組み合わせでシンプルな構成
- 欠点
  - 複数コマンドの組み合わせで若干の複雑さ
  - スクリプト作成が必要

### sqlite3 .backup + gzip + AWS CLI

SQLite 専用バックアップコマンドと AWS CLI を組み合わせる方式。

- 利点
  - SQLite の標準機能による安全なバックアップ
  - AWS CLI による S3 互換ストレージアップロード
  - エンドポイント設定で S3 互換サービス利用可能
  - AWS 公式ツールで情報が豊富
- 欠点
  - 頻繁なアップデートで保守負荷が高い
  - AWS 以外のエコシステムでの利用に適さない

### Restic

専用バックアップソリューションによる高機能バックアップ方式。

- 利点
  - 暗号化、重複排除、増分バックアップ機能を内蔵
  - S3 互換ストレージに直接対応
  - バックアップの整合性チェック機能
- 欠点
  - 設定と運用が複雑で一人開発制約に不適合
  - Go 言語依存でバイナリ管理が必要
  - 個人用途には過剰な機能性

### rclone 単体(ファイルコピー)

クラウドストレージツールによる直接ファイル同期方式。

- 利点
  - Cloudflare R2 をネイティブサポート
  - 高速なファイル転送機能
  - 同期・暗号化機能を内蔵
- 欠点
  - SQLite ファイル直接コピーで整合性リスク
  - データベース使用中のバックアップで不整合の可能性

## 判断基準による評価

### 保守性の比較

**sqlite3 + rclone** が最優秀である。標準ツールの組み合わせで長期安定性が高く、設定がシンプルで理解しやすい。**AWS CLI** は頻繁なアップデートで保守負荷が高く、**Restic** は設定が複雑で一人運用に不適合である。

### 信頼性の比較

**sqlite3 .backup** を使用する方式が最優秀である。SQLite 公式のホットバックアップ機能により、データベース使用中でも整合性を保ったバックアップが可能である。**rclone 単体**はファイル直接コピーで整合性リスクがあり、データベース使用中のバックアップで不整合が発生する可能性が高い。

### 性能の比較

全ての選択肢が個人用途には十分な性能を提供する。**sqlite3 + 圧縮**の組み合わせは軽量で必要十分であり、**Restic** の増分バックアップは効率的だが、個人用途では過剰である。

### 互換性の比較

**rclone** を使用する方式が最優秀である。Cloudflare R2 をネイティブサポートし、Cloudflare エコシステムとの親和性が高い。**AWS CLI** は S3 互換対応可能だが、エンドポイント設定が複雑で AWS 以外のエコシステムでの利用に適さない。

### 学習コストの比較

**sqlite3 + rclone** が最優秀である。標準的なツールで理解しやすく、既存の知識を活用できる。**Restic** は高機能だが概念理解が必要で学習コストが高い。**AWS CLI** は AWS 依存の設定知識が必要である。

## 最終選択と根拠

### 選択結果

<!-- GLOBAL_CONCLUSION_BEGIN: backup-method-tech-selection -->

バックアップ方法技術として **sqlite3 .backup + gzip + rclone** を採用する。

<!-- GLOBAL_CONCLUSION_END: backup-method-tech-selection -->

### 選択根拠

各評価軸を総合すると、**sqlite3 .backup + gzip + rclone** の組み合わせが最適解である。

1. **保守性**: 標準ツールで長期安定、設定シンプル
2. **信頼性**: SQLite 公式バックアップで安全性最高
3. **性能**: 軽量で必要十分
4. **互換性**: Cloudflare エコシステムとの親和性
5. **学習コスト**: 既存の知識を活用できる

この構成により、個人用途に適したシンプルで確実なデータ保護基盤を実現し、一人運用での長期安定性を確保する。
