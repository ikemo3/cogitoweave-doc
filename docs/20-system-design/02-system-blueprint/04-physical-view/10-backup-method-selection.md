---
doc_type: "pattern-choice"
status: "draft"
depends:
  contracts: []
  produces:
    - "backup-method-tech-selection"
---

# バックアップ方法技術選択

## 前提

CogitoWeave システムのバックアップ方法技術選択を実施する。

### バックアップ要件

- **対象データ**: SQLite データベースファイルのみ(画像等の使用予定なし)
- **実行時刻**: 深夜 2 時に実行
- **世代管理**: 30 日間の履歴保持
- **復旧方式**: 手動復旧による当日復旧を目標
- **保存先**: S3 互換ストレージサービスを活用
- **運用方針**: 一人開発制約によるシンプルで理解しやすい構成

## 調査

### バックアップ方法の選択肢

#### 1. sqlite3 .backup + gzip + rclone

SQLite 専用バックアップコマンドと圧縮、クラウドアップロードを組み合わせる方式。

- SQLite の標準機能によるホットバックアップで安全性が高い
- データベース使用中でも整合性を保ったバックアップが可能
- gzip 圧縮でストレージ効率を向上
- rclone による Cloudflare R2 へのネイティブアップロード
- 標準ツールの組み合わせでシンプルな構成

#### 2. sqlite3 .backup + gzip + AWS CLI

SQLite 専用バックアップコマンドと AWS CLI を組み合わせる方式。

- SQLite の標準機能による安全なバックアップ
- AWS CLI による S3 互換ストレージアップロード
- エンドポイント設定で S3 互換サービス利用可能
- AWS 公式ツールで情報が豊富
- 頻繁なアップデートで保守負荷が高い

#### 3. Restic

専用バックアップソリューションによる高機能バックアップ方式。

- 暗号化、重複排除、増分バックアップ機能を内蔵
- S3 互換ストレージに直接対応
- バックアップの整合性チェック機能
- 設定と運用が複雑で一人開発制約に不適合
- Go 言語依存でバイナリ管理が必要

#### 4. rclone 単体(ファイルコピー)

クラウドストレージツールによる直接ファイル同期方式。

- Cloudflare R2 をネイティブサポート
- 高速なファイル転送機能
- 同期・暗号化機能を内蔵
- SQLite ファイル直接コピーで整合性リスク
- データベース使用中のバックアップで不整合の可能性

### 評価基準の設定

1. **保守性** - 長期運用での管理しやすさ、アップデート頻度、設定の複雑さ
2. **信頼性** - データ損失リスク、バックアップ成功率、復旧確実性
3. **性能** - バックアップ速度、ストレージ効率、リソース使用量
4. **互換性** - S3 互換ストレージとの親和性、Cloudflare エコシステムとの整合性
5. **学習コスト** - 習得の容易さ、ドキュメントの充実度

## 論理

### 技術選択の評価

#### 保守性評価

**sqlite3 + rclone** が最優秀である。標準ツールの組み合わせで長期安定性が高く、設定がシンプルで理解しやすい。**AWS CLI** は頻繁なアップデートで保守負荷が高く、**Restic** は設定が複雑で一人運用に不適合である。**rclone 単体**は比較的良好だが、SQLite 専用バックアップの安全性に劣る。

#### 信頼性評価

**sqlite3 .backup** を使用する方式が最優秀である。SQLite 公式のホットバックアップ機能により、データベース使用中でも整合性を保ったバックアップが可能である。**rclone 単体**はファイル直接コピーで整合性リスクがあり、データベース使用中のバックアップで不整合が発生する可能性が高い。

#### 性能評価

全ての選択肢が個人用途には十分な性能を提供する。**sqlite3 + 圧縮**の組み合わせは軽量で必要十分であり、**Restic** の増分バックアップは効率的だが、個人用途では過剰である。

#### 互換性評価

**rclone** を使用する方式が最優秀である。Cloudflare R2 をネイティブサポートし、Cloudflare エコシステムとの親和性が高い。**AWS CLI** は S3 互換対応可能だが、エンドポイント設定が複雑で AWS 以外のエコシステムでの利用に適さない。

#### 学習コスト評価

**sqlite3 + rclone** が最優秀である。標準的なツールで理解しやすく、既存の知識を活用できる。**Restic** は高機能だが概念理解が必要で学習コストが高い。**AWS CLI** は AWS 依存の設定知識が必要である。

### 最終判断

各評価軸を総合すると、**sqlite3 .backup + gzip + rclone** の組み合わせが最適解である。

1. **保守性**: 標準ツールで長期安定、設定シンプル
2. **信頼性**: SQLite 公式バックアップで安全性最高
3. **性能**: 軽量で必要十分
4. **互換性**: Cloudflare エコシステムとの親和性
5. **学習コスト**: 既存の知識を活用できる

## 結論

<!-- GLOBAL_CONCLUSION_BEGIN: backup-method-tech-selection -->

CogitoWeave システムのバックアップ方法技術として以下を採用する。

### バックアップ実行方式

- SQLite 専用の sqlite3 .backup コマンドによるホットバックアップを採用する
- cron による深夜の日次自動実行を実装する
- 実行結果の通知機能により障害の早期検知を支援する

### ストレージとアップロード

- gzip 圧縮によるファイルサイズ削減を実装する
- rclone による S3 互換ストレージへのアップロードを採用する
- 日付ベースのファイル名による明確な世代識別を実装する

### 世代管理と復旧

- 自動世代管理により適切なストレージ効率を実現する
- 手動復旧手順書の整備により当日復旧目標を達成する
- バックアップ検証機能により保存されたデータの整合性を確保する

この構成により、個人用途に適したシンプルで確実なデータ保護基盤を実現し、一人運用での長期安定性を確保する。

<!-- GLOBAL_CONCLUSION_END: backup-method-tech-selection -->
